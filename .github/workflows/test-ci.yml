name: "CI"
on:
  pull_request:
  push:
jobs:
  linux:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout (clean environment)
      uses: actions/checkout@v2.3.4
    - name: Use Cachix (Never build software more than once)
      uses: cachix/install-nix-action@v12
      with: 
        skip_adding_nixpkgs_channel: true
        name: nokx5-golden-cpp
        authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'
    - name: Build Linux Release (run tests)
      run: nix-build . -A hydraJobs.x86_64-linux.release --show-trace
  macos:
    runs-on: macOS-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2.3.4
      - name: Use Cachix (Never build software more than once)
        uses: cachix/install-nix-action@v12
        with:
          skip_adding_nixpkgs_channel: true
          name: nokx5-golden-cpp
          authToken: '${{ secrets.CACHIX_AUTH_TOKEN }}'
      - name: Build MacOS Release (run tests)
        run: nix-build . -A hydraJobs.x86_64-darwin.build-clang --show-trace
